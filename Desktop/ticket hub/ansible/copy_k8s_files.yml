---
- name: Copy Kubernetes manifests to server
  hosts: all
  become: yes
  tasks:
    - name: Create k8s directory
      file:
        path: /opt/ticket-booking/k8s
        state: directory
        mode: '0755'

    - name: Copy Kubernetes manifest files
      copy:
        src: "{{ item }}"
        dest: "/opt/ticket-booking/k8s/{{ item | basename }}"
      loop:
        - "{{ playbook_dir }}/../k8s/configmap.yaml"
        - "{{ playbook_dir }}/../k8s/secret.yaml"
        - "{{ playbook_dir }}/../k8s/postgres-statefulset.yaml"
        - "{{ playbook_dir }}/../k8s/postgres-service.yaml"
        - "{{ playbook_dir }}/../k8s/backend-deployment.yaml"
        - "{{ playbook_dir }}/../k8s/backend-service.yaml"
        - "{{ playbook_dir }}/../k8s/frontend-deployment.yaml"
        - "{{ playbook_dir }}/../k8s/frontend-service.yaml"
        - "{{ playbook_dir }}/../k8s/ingress.yaml"
        - "{{ playbook_dir }}/../k8s/hpa.yaml"

